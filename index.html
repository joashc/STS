<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Sequential Trial Simulator</title>

	<link href="bootstrap.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script type="text/javascript" src="bin/webScript.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
</head>

<body>
	<div class="jumbotron">
		<h1>Sequential Trial Simulator</h1>
		<p>A tool for simulating drug trials.</p>
	</div>
	
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="col-sm-2" id="input">
				<!-- Parameters etc. -->
				<h2>Parameters</h2>
				<!-- TODO: uses lists -->
				<ul class="list-unstyled">
					<li><h3>Stages</h3>
						<!-- TODO: min/max vals -->
						<input type="number" min="0" max="100">
					</li>

					<li><h3>No. individuals</h3>
						<input type="number" min="0">
					</li>

					<li><h3>Rule</h3>
						<!-- TODO: tooltips for how to use Rule -->
						How many need to pass before moving on?<br>
						<input type="number">
					</li>
				</ul>
					<button id="addStage">Add</button>
			</div>

		<div class="col-sm-10" id="trialString">
				<h2>Trial string</h2>
				<p>Fusce arcu velit, scelerisque vel urna non, convallis pretium lectus. Suspendisse at consequat erat. Donec efficitur vestibulum dignissim. Morbi consequat nulla ac felis tincidunt, in pellentesque enim sodales. Donec ac odio ante. Integer pulvinar risus non dolor ullamcorper, eget tincidunt erat sollicitudin. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum quis elementum nisl, id varius leo. Suspendisse bibendum ac magna consectetur eleifend. Fusce et efficitur mi. Aliquam eros ex, pulvinar vitae augue a, porta porta nunc. Nunc vulputate augue sapien, ut varius eros mollis sit amet. Maecenas porttitor tempus placerat. Duis sodales vel purus sit amet auctor. Nam bibendum ipsum nec risus vulputate, at consequat odio auctor.</p>
		</div>
		
		<script>
			var drawGraph = function(area, data) {
				// Set the dimensions of the canvas / graph
				var margin = {top: 30, right: 20, bottom: 30, left: 50},
				    width = 400 - margin.left - margin.right,
				    height = 270 - margin.top - margin.bottom;

				// Parse the date / time
				var parseDate = d3.time.format("%d-%b-%y").parse;

				// Set the ranges
				var x = d3.time.scale().range([0, width]);
				var y = d3.scale.linear().range([height, 0]);

				// Define the axes
				var xAxis = d3.svg.axis().scale(x)
				    .orient("bottom").ticks(5);

				var yAxis = d3.svg.axis().scale(y)
				    .orient("left").ticks(5);

				// Define the line
				var valueline = d3.svg.line()
				    .x(function(d) { return x(d.date); })
				    .y(function(d) { return y(d.close); });
				    
				// Adds the svg canvas
				var svg = d3.select(area)
				    .append("svg")
				        .attr("width", width + margin.left + margin.right)
				        .attr("height", height + margin.top + margin.bottom)
				    .append("g")
				        .attr("transform", 
				              "translate(" + margin.left + "," + margin.top + ")");

				// Get the data
				d3.csv(data, function(error, data) {
				    data.forEach(function(d) {
				        d.date = parseDate(d.date);
				        d.close = +d.close;
				    });

				    // Scale the range of the data
				    x.domain(d3.extent(data, function(d) { return d.date; }));
				    y.domain([0, d3.max(data, function(d) { return d.close; })]);

				    // Add the valueline path.
				    svg.append("path")
				        .attr("class", "line")
				        .attr("d", valueline(data));

				    // Add the X Axis
				    svg.append("g")
				        .attr("class", "x axis")
				        .attr("transform", "translate(0," + height + ")")
				        .call(xAxis);

				    // Add the Y Axis
				    svg.append("g")
				        .attr("class", "y axis")
				        .call(yAxis);
				});
			};
		</script>

		<!-- Output graphs div -->
		<div class="row-fluid">
			<div class="col-sm-10" id="output">
				<h2>Output graphs</h2>

				<div class="col-sm-5" id="area1">
			        <svg id="visualisation" width="400" height="270"></svg>
			 		<script>
			 			var data = [{
						    "sale": "202",
						    "year": "0.0"
						}, {
						    "sale": "215",
						    "year": "0.1"
						}, {
						    "sale": "179",
						    "year": "0.2"
						}, {
						    "sale": "199",
						    "year": "0.3"
						}, {
						    "sale": "134",
						    "year": "0.4"
						}, {
						    "sale": "176",
						    "year": "0.5"
						}];

						var vis = d3.select("#visualisation"),
						    WIDTH = 400,
						    HEIGHT = 270,
						    MARGINS = {
						        top: 20,
						        right: 20,
						        bottom: 20,
						        left: 50
						    },

					    xScale = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([0,1]),
					    yScale = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([134,215]),

					    xAxis = d3.svg.axis()
						    .scale(xScale),
						  
						yAxis = d3.svg.axis()
						    .scale(yScale)
			    			.orient("left");

					    vis.append("svg:g")
						    .attr("transform", "translate(0," + (HEIGHT - MARGINS.bottom) + ")")
						    .call(xAxis);
					    vis.append("svg:g")
						    .attr("transform", "translate(" + (MARGINS.left) + ",0)")
						    .call(yAxis);

					    var lineGen = d3.svg.line()
							.x(function(d) {
							return xScale(d.year);
							})
							.y(function(d) {
							return yScale(d.sale);
							});

						vis.append('svg:path')
						  .attr('d', lineGen(data))
						  .attr('fill', 'none');

						var lineGen = d3.svg.line()
						    .x(function(d) {
						        return xScale(d.year);
						    })
						    .y(function(d) {
						        return yScale(d.sale);
						    })
						    .interpolate("basis");
			 		</script>
				</div>

				<div class="col-sm-5" id="area2">
					<script>
						//drawGraph("#area1", "data2.csv");
						drawGraph("#area2", "data2.csv");
					</script>
				</div>
			</div>
		</div>
	</div>

	<footer>
		<div class="container">
	    	<p>STS for Health Hack 2015. &copy; 2015</p>
	    	<p>
		    	<a href="#">Back to top</a>
	    	</p>
	    </div>
    </footer>
</body>
</html>