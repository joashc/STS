<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Sequential Trial Simulator</title>

	<link href="src/bootstrap.css" rel="stylesheet">
	<link href="src/style.css" rel="stylesheet">
	<script src="src/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="src/ramda.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="src/nv.d3.min.js"></script>
	<script src="src/jstat.min.js"></script>
	<script src="src/ramda.min.js"></script>
	<script src="src/stage.js"></script>
	<script src="src/sts.js"></script>
	<script src="src/bootstrap.js"></script>
    <script src="src/angular.min.js"></script>
    <script src="src/ngd3.min.js"></script>
    <script src="src/stages.js"></script>
	<script type="text/javascript" src="src/webScript.js"></script>
	<link href="src/nv.d3.min.css" rel="stylesheet">
	<style type="text/css">
	li.stage {
		width : 280px;
	}

	li.stage .form-number {
		margin-right: 0px;
	}
	</style>
</head>

<body ng-app="sts">
	<div class="jumbotron">
		<h1>Sequential Trial Simulator</h1>
		<p>A tool for simulating drug trials.</p>
		<a href="splash.html">About</a>
	</div>
	
	<div class="container-fluid">
		<div class="row-fluid">
			<div id="message"></div>
			

		<div class="col-sm-12" id="trialString">
			<form id="trialDesign" class="form-horizontal"
			    data-fv-framework="bootstrap"
			    data-fv-icon-valid="glyphicon glyphicon-ok"
			    data-fv-icon-invalid="glyphicon glyphicon-remove"
			    data-fv-icon-validating="glyphicon glyphicon-refresh">

				<h2>Trial string</h2>
				<ul id="trialSim" class="list-inline">
                    <stages></stages>
                </ul>
                <add-stage></add-stage>
				<button id="start">Start</button>
			</form>
		</div>
		
		<!-- Output graphs div -->
		<div class="row-fluid">

			<div class="col-sm-12" id="output">
				<h2>Output graphs</h2>
            <graphs></graphs>
				<ul id="displayGraph" class="list-inline">
	                <li class="graph"><svg id="trgraph" width="350" height="330"></svg></li>

	                <li class="graph"><svg id="visualisation" width="350" height="330"></svg></li>

	                <li class="graph"><svg id="trgivenfail" width="350" height="330"></svg></li>
				</ul>


		 		<script>
				var drawGraph = function (data, graphLocation, trGivenSType) {
				    $(graphLocation).html(''); //#trgraph, #visualisation, #trgivenfail
					var firstData = R.last(data);
					var lastData = R.head(data);
					var trueRate = R.prop('trueRate');
					var trGivenS  = R.prop(trGivenSType); //passFraction, trGivenS, trGivenF
					var firstTrueRate = trueRate(firstData);
					var lastTrueRate = trueRate(lastData);
					var firstTrGivenS = trGivenS(firstData);
					var lastTrGivenS = trGivenS(lastData);

					var vis = d3.select(graphLocation),
					    WIDTH = 350,
					    HEIGHT = 330,
					    MARGINS = {
					        top: 20,
					        right: 20,
					        bottom: 50,
					        left: 50
					    },

				    xScale = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([firstTrueRate,lastTrueRate]),
				    yScale = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([lastTrGivenS, firstTrGivenS]),

				    xAxis = d3.svg.axis()
					    .scale(xScale),
					  
					yAxis = d3.svg.axis()
					    .scale(yScale)
		    			.orient("left");

				    vis.append("svg:g")
					    .attr("transform", "translate(0," + (HEIGHT - MARGINS.bottom) + ")")
					    .call(xAxis);
				    vis.append("svg:g")
					    .attr("transform", "translate(" + (MARGINS.left) + ",0)")
					    .call(yAxis);

				    var lineGen = d3.svg.line()
						.x(function(d) {
						return xScale(d.trueRate);
						})
						.y(function(d) {
						return yScale(d[trGivenSType]);
						});

					vis.append('svg:path')
					  .attr('d', lineGen(data));

					// Graph title
					vis.append('text')
                        .attr('transform', 'translate(200, 20)')
				        .attr('text-anchor', 'middle')
				        .text(graphLocation);

					// x axis label
                    vis.append('text')
                        .attr('transform', 'translate(200, 320)')
                        .style('text-anchor', 'middle')
                        .text('True efficacy/toxicity');

                    // y axis label
                    vis.append('text')
					    .attr('dy', '1em')
					    .attr('transform', 'rotate(-90)')
                        .style('text-anchor', 'end')
					    .text('Probability');

					var lineGen = d3.svg.line()
					    .x(function(d) {
					    	// TODO: change var name
					        return xScale(d.year);
					    })
					    .y(function(d) {
					    	// TODO: change var name
					        return yScale(d.sale);
					    })
					    .interpolate("basis");
				};
		 		</script>
		</div>
	</div>

	<footer>
		<div class="container">
	    	<p>STS for Health Hack 2015. &copy; 2015</p>
	    	<p>
		    	<a href="#">Back to top</a>
	    	</p>
	    </div>
    </footer>
</body>
</html>
