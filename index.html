<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Sequential Trial Simulator</title>

	<link href="src/bootstrap.css" rel="stylesheet">
	<link href="src/style.css" rel="stylesheet">
	<script src="src/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="src/ramda.min.js"></script>
	<script type="text/javascript" src="src/webScript.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="src/jstat.min.js"></script>
	<script src="src/ramda.min.js"></script>
	<script src="src/stage.js"></script>
	<script src="src/sts.js"></script>
	<script src="src/bootstrap.js"></script>
</head>

<body>
	<div class="jumbotron">
		<h1>Sequential Trial Simulator</h1>
		<p>A tool for simulating drug trials.</p>
		<a href="splash.html">About</a>
	</div>
	
	<div class="container-fluid">
		<div class="row-fluid">
			<div id="message"></div>
			
		<div class="col-sm-12" id="distSetting">
			<h3> True rate distribution settings </h3>
		    Uniform: 		<input type = "radio" name = "distType" value="uniform" checked="checked">&nbsp
			Normal: 		<input type = "radio" name = "distType" value="normal">&nbsp
			LogitNormal: 	<input type = "radio" name = "distType" value="logitnormal">
			<br>
			<div class="col-lg-12" id="uniform">
				<div class="col-sm-4" id="uniform">
					<br>
					Min: <input type = "text" name = "min" value="0" size="2">
					<br>
					Max: <input type = "text" name = "max" value="1" size="2">
				</div>

				<div class="col-sm-4" id="normal" hidden>
					<br>
				
					Mean: <input type = "text" name = "min" value="0" size="2">
					<br>
					Standard Deviation: <input type = "text" name = "max" value="1" size="2">
				</div>
			
				<div class="col-sm-4" id="logitnormal" hidden>
					<br>
				
					Mean: <input type = "text" name = "min" value="0" size="2">
					<br>
					Standard Deviation: <input type = "text" name = "max" value="1" size="2">
				</div>

				<div class = "col-sm-5" id = "distGraphs">
					<img src="http://vignette1.wikia.nocookie.net/universe-of-smash-bros-lawl/images/d/d2/Awesome_Face.png/revision/latest?cb=20150626002703" width="100px">
				</div>
			</div>

			
			</div>
		<div class="col-sm-12" id="trialString">
			<form id="trialDesign" class="form-horizontal"
			    data-fv-framework="bootstrap"
			    data-fv-icon-valid="glyphicon glyphicon-ok"
			    data-fv-icon-invalid="glyphicon glyphicon-remove"
			    data-fv-icon-validating="glyphicon glyphicon-refresh">

				<h2>Trial sequence</h2>

				
				<!-- Boxes for entering the true rate - not required
				Lower bound for true rate:
				<input type = "number" name = "trueRateLower" id="trueRateLower" step=".1" value="0">&nbsp
				Upper bound for true rate:
				<input type = "number" name = "trueRateUpper" id="trueRateUpper" step=".1" value="1">&nbsp
				True rate step size:
				<input type = "number" name = "trueRateStep" id="trueRateStep" step=".1" value="0.1">
				<br><br> -->

				<ul id="trialSim" class="list-inline"></ul>
				<button id="start">Start</button>
			</form>
		</div>
		
		<!-- Output graphs div -->
		<div class="row-fluid">
			<div class="col-sm-12" id="output">
				<h2>Output graphs</h2>
				<ul id="displayGraph" class="list-inline">
	                <li class="graph"><svg id="trgraph" width="350" height="330"></svg></li>

	                <li class="graph"><svg id="visualisation" width="350" height="330"></svg></li>

	                <li class="graph"><svg id="trgivenfail" width="350" height="330"></svg></li>
				</ul>

		 		<script>
				var drawGraph = function (data, graphLocation, trGivenSType) {
				    $(graphLocation).html(''); //#trgraph, #visualisation, #trgivenfail
					var firstData = R.last(data);
					var lastData = R.head(data);
					var trueRate = R.prop('trueRate');
					var trGivenS  = R.prop(trGivenSType); //passFraction, trGivenS, trGivenF
					var firstTrueRate = trueRate(firstData);
					var lastTrueRate = trueRate(lastData);
					var firstTrGivenS = trGivenS(firstData);
					var lastTrGivenS = trGivenS(lastData);

					var vis = d3.select(graphLocation),
					    WIDTH = 350,
					    HEIGHT = 330,
					    MARGINS = {
					        top: 20,
					        right: 20,
					        bottom: 50,
					        left: 50
					    },

				    xScale = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([firstTrueRate,lastTrueRate]),
				    yScale = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([lastTrGivenS, firstTrGivenS]),

				    xAxis = d3.svg.axis()
					    .scale(xScale),
					  
					yAxis = d3.svg.axis()
					    .scale(yScale)
		    			.orient("left");

				    vis.append("svg:g")
					    .attr("transform", "translate(0," + (HEIGHT - MARGINS.bottom) + ")")
					    .call(xAxis);
				    vis.append("svg:g")
					    .attr("transform", "translate(" + (MARGINS.left) + ",0)")
					    .call(yAxis);

				    var lineGen = d3.svg.line()
						.x(function(d) {
						return xScale(d.trueRate);
						})
						.y(function(d) {
						return yScale(d[trGivenSType]);
						});

					vis.append('svg:path')
					  .attr('d', lineGen(data));

					// Graph title
					vis.append('text')
                        .attr('transform', 'translate(200, 20)')
				        .attr('text-anchor', 'middle')
				        .text(graphLocation);

					// x axis label
                    vis.append('text')
                        .attr('transform', 'translate(200, 320)')
                        .style('text-anchor', 'middle')
                        .text('True efficacy/toxicity');

                    // y axis label
                    vis.append('text')
					    .attr('dy', '1em')
					    .attr('transform', 'rotate(-90)')
                        .style('text-anchor', 'end')
					    .text('Probability');

					var lineGen = d3.svg.line()
					    .x(function(d) {
					    	// TODO: change var name
					        return xScale(d.year);
					    })
					    .y(function(d) {
					    	// TODO: change var name
					        return yScale(d.sale);
					    })
					    .interpolate("basis");
				};
		 		</script>
		</div>
	</div>

	<footer>
		<div class="container">
	    	<p>STS for Health Hack 2015. &copy; 2015</p>
	    	<p>
		    	<a href="#">Back to top</a>
	    	</p>
	    </div>
    </footer>
</body>
</html>
